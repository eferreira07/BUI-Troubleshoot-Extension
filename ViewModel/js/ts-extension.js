define(["require", "exports", "./ts-ticker", "./ts-logger", "./ts-results", "./ts-utilities"], function (require, exports, ts_ticker_1, ts_logger_1, ts_results_1, TsUtilities) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var TsExtension = (function () {
        function TsExtension() {
            this.isRunning = false;
            this.warnsIndex = 0;
            var self = this;
            self.initialize();
        }
        TsExtension.prototype.initialize = function () {
            var self = this;
            var startBtn = document.createElement('button');
            var stopBtn = document.createElement('button');
            var timer = document.createElement('time');
            var tsTicker = new ts_ticker_1.TsTicker();
            var tsLogger = new ts_logger_1.TsLogger();
            var osvcTsConfig = "select value from configurations where lookupName = 'CUSTOM_CFG_TS'";
            TsUtilities.myROQLQuery(osvcTsConfig).then(function (result) {
                result["items"].forEach(function (rows) {
                    rows["rows"].forEach(function (value) {
                        var obj = JSON.parse(value);
                        tsLogger.tsDebugLevel = obj.debugLevel;
                        tsLogger.tsPerformance = obj.performance;
                    });
                });
            });
            startBtn.textContent = " Start";
            startBtn.style.color = "green";
            startBtn.className = "btn fa fa-play-circle";
            startBtn.onclick = function () {
                self.isRunning = true;
                startBtn.style.color = "gray";
                startBtn.style.opacity = "0.3";
                startBtn.style.cursor = "not-allowed";
                startBtn.disabled = true;
                stopBtn.style.color = "red";
                stopBtn.style.opacity = "1";
                stopBtn.style.cursor = "pointer";
                stopBtn.disabled = false;
                self.startCapture(self.isRunning, tsTicker, tsLogger);
            };
            stopBtn.textContent = " Stop";
            stopBtn.style.color = "gray";
            stopBtn.style.opacity = "0.3";
            stopBtn.style.cursor = "not-allowed";
            stopBtn.className = "btn fa fa-stop-circle";
            stopBtn.onclick = function () {
                stopBtn.style.color = "gray";
                stopBtn.style.opacity = "0.3";
                stopBtn.style.cursor = "not-allowed";
                stopBtn.disabled = true;
                startBtn.style.color = "green";
                startBtn.style.opacity = "1";
                startBtn.style.cursor = "pointer";
                startBtn.disabled = false;
                self.stopCapture(self.isRunning, tsTicker, tsLogger);
            };
            timer.textContent = "00:00:00";
            timer.className = "time";
            timer.style.cursor = "not-allowed";
            timer.style.padding = "4px";
            timer.style.fontFamily = "auto";
            document.getElementById("startBtn").appendChild(startBtn);
            document.getElementById("stopBtn").appendChild(stopBtn);
            document.getElementById("timer").appendChild(timer);
        };
        TsExtension.prototype.startCapture = function (isRunning, tsTicker, tsLogger) {
            if (isRunning == true) {
                tsTicker.startTimer();
                TsUtilities.getOSvCInterface(tsLogger);
                var osvcQuery = 'select name.first, name.last, displayName, login from accounts where id = ' + tsLogger.osvcUserId;
                TsUtilities.myROQLQuery(osvcQuery).then(function (result) {
                    result["items"].forEach(function (rows) {
                        rows["rows"].forEach(function (value) {
                            tsLogger.setUserInfo(value);
                        });
                    });
                });
                if (tsLogger.tsPerformance) {
                    window.parent.ORACLE_SERVICE_CLOUD.Configuration.isPerformanceMonitoringEnabled = true;
                }
                if (tsLogger.tsDebugLevel > 0) {
                    window.parent.ORACLE_SERVICE_CLOUD.Configuration.logLevel = 5;
                }
                navigator.sayswho = (function () {
                    var ua = navigator.userAgent, tem, M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
                    if (/trident/i.test(M[1])) {
                        tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
                        return 'IE ' + (tem[1] || '');
                    }
                    if (M[1] === 'Chrome') {
                        tem = ua.match(/\b(OPR|Edge)\/(\d+)/);
                        if (tem != null)
                            return tem.slice(1).join(' ').replace('OPR', 'Opera');
                    }
                    M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
                    if ((tem = ua.match(/version\/(\d+)/i)) != null)
                        M.splice(1, 1, tem[1]);
                    return M.join(' ');
                })();
                tsLogger.tsNavigatorInfo = navigator.sayswho;
                console.defaultLog = console.log.bind(window.parent.console);
                console.logs = [];
                window.parent.console.log = function () {
                    console.defaultLog(console, arguments);
                    var message = "";
                    Array.from(arguments).forEach(function (value) {
                        message = message + '\n' + value;
                    });
                    tsLogger.tsConsoleLog.push({ 'id': tsLogger.tsConsoleLog.length + 1, 'log': message });
                };
                console.defaultError = console.error.bind(window.parent.console);
                console.errors = [];
                window.parent.console.error = function () {
                    console.defaultError.apply(console, arguments);
                    var message = "";
                    Array.from(arguments).forEach(function (value) {
                        message = message + '\n' + value;
                    });
                    tsLogger.tsConsoleError.push({ 'id': tsLogger.tsConsoleError.length + 1, 'log': message });
                };
                console.defaultWarn = console.warn.bind(window.parent.console);
                console.warns = [];
                window.parent.console.warn = function () {
                    console.defaultWarn.apply(console, arguments);
                    var message = "";
                    Array.from(arguments).forEach(function (value) {
                        message = message + '\n' + value;
                    });
                    tsLogger.tsConsoleWarn.push({ 'id': tsLogger.tsConsoleWarn.length + 1, 'log': message });
                };
                console.defaultDebug = console.debug.bind(window.parent.console);
                console.debugs = [];
                window.parent.console.debug = function () {
                    console.defaultDebug.apply(console, arguments);
                    var message = "";
                    Array.from(arguments).forEach(function (value) {
                        message = message + '\n' + value;
                    });
                    tsLogger.tsConsoleDebug.push({ 'id': tsLogger.tsConsoleDebug.length + 1, 'log': message });
                };
            }
        };
        TsExtension.prototype.stopCapture = function (isRunning, tsTicker, tsLogger) {
            if (isRunning == true) {
                isRunning = false;
                window.parent.ORACLE_SERVICE_CLOUD.Configuration.logLevel = 0;
                window.parent.ORACLE_SERVICE_CLOUD.Configuration.isPerformanceMonitoringEnabled = false;
                tsTicker.stopTimer(tsLogger);
                var tsResults = new ts_results_1.TsResults(tsLogger);
                tsResults.saveLocalBlob();
                TsUtilities.MyModalWindow();
                tsLogger.tsConsoleDebug = [];
                tsLogger.tsConsoleWarn = [];
                tsLogger.tsConsoleError = [];
                tsLogger.tsConsoleLog = [];
            }
        };
        return TsExtension;
    }());
    new TsExtension();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHMtZXh0ZW5zaW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc2NyaXB0cy90cy1leHRlbnNpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBT0E7UUFLSTtZQUhBLGNBQVMsR0FBRyxLQUFLLENBQUM7WUFDbEIsZUFBVSxHQUFXLENBQUMsQ0FBQztZQUduQixJQUFNLElBQUksR0FBRyxJQUFJLENBQUM7WUFDbEIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3RCLENBQUM7UUFFRCxnQ0FBVSxHQUFWO1lBQ0ksSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLElBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDaEQsSUFBSSxPQUFPLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMvQyxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzNDLElBQU0sUUFBUSxHQUFHLElBQUksb0JBQVEsRUFBRSxDQUFDO1lBQ2hDLElBQU0sUUFBUSxHQUFHLElBQUksb0JBQVEsRUFBRSxDQUFDO1lBRWhDLElBQU0sWUFBWSxHQUFHLHFFQUFxRSxDQUFDO1lBRTNGLFdBQVcsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVMsTUFBTTtnQkFDdEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFTLElBQUk7b0JBQ2pDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBUyxLQUFLO3dCQUMvQixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUM1QixRQUFRLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUM7d0JBQ3ZDLFFBQVEsQ0FBQyxhQUFhLEdBQUcsR0FBRyxDQUFDLFdBQVcsQ0FB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VyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi9vc3ZjRXh0ZW5zaW9uLmQudHNcIi8+XHJcblxyXG5pbXBvcnQgeyBUc1RpY2tlciB9IGZyb20gXCIuL3RzLXRpY2tlclwiO1xyXG5pbXBvcnQgeyBUc0xvZ2dlciB9IGZyb20gXCIuL3RzLWxvZ2dlclwiO1xyXG5pbXBvcnQgeyBUc1Jlc3VsdHMgfSBmcm9tIFwiLi90cy1yZXN1bHRzXCI7XHJcbmltcG9ydCBUc1V0aWxpdGllcyA9IHJlcXVpcmUoJy4vdHMtdXRpbGl0aWVzJyk7XHJcblxyXG5jbGFzcyBUc0V4dGVuc2lvbiB7XHJcbiAgICBcclxuICAgIGlzUnVubmluZyA9IGZhbHNlO1xyXG4gICAgd2FybnNJbmRleDogbnVtYmVyID0gMDtcclxuICAgIFxyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgICAgICBzZWxmLmluaXRpYWxpemUoKTsgICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBpbml0aWFsaXplKCkge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGxldCBzdGFydEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG4gICAgICAgIGxldCBzdG9wQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XHJcbiAgICAgICAgbGV0IHRpbWVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGltZScpOyBcclxuICAgICAgICBjb25zdCB0c1RpY2tlciA9IG5ldyBUc1RpY2tlcigpO1xyXG4gICAgICAgIGNvbnN0IHRzTG9nZ2VyID0gbmV3IFRzTG9nZ2VyKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG9zdmNUc0NvbmZpZyA9IFwic2VsZWN0IHZhbHVlIGZyb20gY29uZmlndXJhdGlvbnMgd2hlcmUgbG9va3VwTmFtZSA9ICdDVVNUT01fQ0ZHX1RTJ1wiO1xyXG4gICAgICAgIFxyXG4gICAgICAgIFRzVXRpbGl0aWVzLm15Uk9RTFF1ZXJ5KG9zdmNUc0NvbmZpZykudGhlbihmdW5jdGlvbihyZXN1bHQpe1xyXG4gICAgICAgICAgICByZXN1bHRbXCJpdGVtc1wiXS5mb3JFYWNoKGZ1bmN0aW9uKHJvd3Mpe1xyXG4gICAgICAgICAgICAgICAgcm93c1tcInJvd3NcIl0uZm9yRWFjaChmdW5jdGlvbih2YWx1ZSl7IFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB0c0xvZ2dlci50c0RlYnVnTGV2ZWwgPSBvYmouZGVidWdMZXZlbDtcclxuICAgICAgICAgICAgICAgICAgICB0c0xvZ2dlci50c1BlcmZvcm1hbmNlID0gb2JqLnBlcmZvcm1hbmNlOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICB9KTsgICAgICAgXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAvLyBXaGVuIHRoZSBzdGFydCBidXR0b24gaXMgY2xpY2tlZCBpdCBpcyB0dXJuZWQgZGlzYmFsZWQgYW5kIGdyYXkuIEF0IHRoaXMgdGltZSB0aGUgc3RvcCBidXR0b24gdHVybmVkIHRvIHJlZCBhbmQgYW5hYmxlZC5cclxuICAgICAgICBzdGFydEJ0bi50ZXh0Q29udGVudCA9IFwiIFN0YXJ0XCI7XHJcbiAgICAgICAgc3RhcnRCdG4uc3R5bGUuY29sb3IgPSBcImdyZWVuXCI7XHJcbiAgICAgICAgc3RhcnRCdG4uY2xhc3NOYW1lID0gXCJidG4gZmEgZmEtcGxheS1jaXJjbGVcIjtcclxuICAgICAgICBzdGFydEJ0bi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHNlbGYuaXNSdW5uaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHN0YXJ0QnRuLnN0eWxlLmNvbG9yID0gXCJncmF5XCI7XHJcbiAgICAgICAgICAgIHN0YXJ0QnRuLnN0eWxlLm9wYWNpdHkgPSBcIjAuM1wiO1xyXG4gICAgICAgICAgICBzdGFydEJ0bi5zdHlsZS5jdXJzb3IgPSBcIm5vdC1hbGxvd2VkXCI7XHJcbiAgICAgICAgICAgIHN0YXJ0QnRuLmRpc2FibGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHN0b3BCdG4uc3R5bGUuY29sb3IgPSBcInJlZFwiO1xyXG4gICAgICAgICAgICBzdG9wQnRuLnN0eWxlLm9wYWNpdHkgPSBcIjFcIjtcclxuICAgICAgICAgICAgc3RvcEJ0bi5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICAgICAgc3RvcEJ0bi5kaXNhYmxlZCA9IGZhbHNlOyAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgLy8gY2FsbCBzdGFydCBwcm9jZXNzIHRvIGNhcHR1cmUgbG9nOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBzZWxmLnN0YXJ0Q2FwdHVyZShzZWxmLmlzUnVubmluZywgdHNUaWNrZXIsIHRzTG9nZ2VyKTsgXHJcbiAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFdoZW4gdGhlIHN0b3AgYnV0dG9uIGlzIGNsaWNrZWQgaXQgaXMgdHVybmVkIGRpc2JhbGVkIGFuZCBncmF5LiBBdCB0aGlzIHRpbWUgdGhlIHN0YXJ0IGJ1dHRvbiB0dXJuZWQgdG8gZ3JlZW4gYW5kIGFuYWJsZWQuXHJcbiAgICAgICAgc3RvcEJ0bi50ZXh0Q29udGVudCA9IFwiIFN0b3BcIjtcclxuICAgICAgICBzdG9wQnRuLnN0eWxlLmNvbG9yID0gXCJncmF5XCI7XHJcbiAgICAgICAgc3RvcEJ0bi5zdHlsZS5vcGFjaXR5ID0gXCIwLjNcIlxyXG4gICAgICAgIHN0b3BCdG4uc3R5bGUuY3Vyc29yID0gXCJub3QtYWxsb3dlZFwiO1xyXG4gICAgICAgIHN0b3BCdG4uY2xhc3NOYW1lID0gXCJidG4gZmEgZmEtc3RvcC1jaXJjbGVcIjtcclxuICAgICAgICBzdG9wQnRuLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHN0b3BCdG4uc3R5bGUuY29sb3IgPSBcImdyYXlcIjtcclxuICAgICAgICAgICAgc3RvcEJ0bi5zdHlsZS5vcGFjaXR5ID0gXCIwLjNcIjtcclxuICAgICAgICAgICAgc3RvcEJ0bi5zdHlsZS5jdXJzb3IgPSBcIm5vdC1hbGxvd2VkXCI7XHJcbiAgICAgICAgICAgIHN0b3BCdG4uZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgc3RhcnRCdG4uc3R5bGUuY29sb3IgPSBcImdyZWVuXCI7XHJcbiAgICAgICAgICAgIHN0YXJ0QnRuLnN0eWxlLm9wYWNpdHkgPSBcIjFcIjtcclxuICAgICAgICAgICAgc3RhcnRCdG4uc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XHJcbiAgICAgICAgICAgIHN0YXJ0QnRuLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIGNhbGwgc3RvcCBwcm9jZXNzIHRvIHNob3cgbG9nIGNhcHR1cmUgcmVzdWx0cy5cclxuICAgICAgICAgICAgc2VsZi5zdG9wQ2FwdHVyZShzZWxmLmlzUnVubmluZywgdHNUaWNrZXIgLHRzTG9nZ2VyKTsgICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRpbWVyLnRleHRDb250ZW50ID0gXCIwMDowMDowMFwiO1xyXG4gICAgICAgIHRpbWVyLmNsYXNzTmFtZSA9IFwidGltZVwiO1xyXG4gICAgICAgIHRpbWVyLnN0eWxlLmN1cnNvciA9IFwibm90LWFsbG93ZWRcIjtcclxuICAgICAgICB0aW1lci5zdHlsZS5wYWRkaW5nID0gXCI0cHhcIjtcclxuICAgICAgICB0aW1lci5zdHlsZS5mb250RmFtaWx5ID0gXCJhdXRvXCI7XHJcblxyXG4gICAgICAgIC8vRGVmaW5lIFN0YXR1cyBCYXIgSFRNTCBFbGVtZW50cy5cclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0QnRuXCIpLmFwcGVuZENoaWxkKHN0YXJ0QnRuKTtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0b3BCdG5cIikuYXBwZW5kQ2hpbGQoc3RvcEJ0bik7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGltZXJcIikuYXBwZW5kQ2hpbGQodGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBzdGFydENhcHR1cmUoaXNSdW5uaW5nOiBib29sZWFuLCB0c1RpY2tlcjogVHNUaWNrZXIsIHRzTG9nZ2VyOiBUc0xvZ2dlcil7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYoaXNSdW5uaW5nID09IHRydWUpe1xyXG5cclxuICAgICAgICAgICAgLy9TdGFydCBzdG9wLXdhdGNoZXIuXHJcbiAgICAgICAgICAgIHRzVGlja2VyLnN0YXJ0VGltZXIoKTtcclxuXHJcbiAgICAgICAgICAgIFRzVXRpbGl0aWVzLmdldE9TdkNJbnRlcmZhY2UodHNMb2dnZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3Qgb3N2Y1F1ZXJ5ID0gJ3NlbGVjdCBuYW1lLmZpcnN0LCBuYW1lLmxhc3QsIGRpc3BsYXlOYW1lLCBsb2dpbiBmcm9tIGFjY291bnRzIHdoZXJlIGlkID0gJysgdHNMb2dnZXIub3N2Y1VzZXJJZDtcclxuICAgICAgICBcclxuICAgICAgICAgICAgVHNVdGlsaXRpZXMubXlST1FMUXVlcnkob3N2Y1F1ZXJ5KS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRbXCJpdGVtc1wiXS5mb3JFYWNoKGZ1bmN0aW9uKHJvd3Mpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJvd3NbXCJyb3dzXCJdLmZvckVhY2goZnVuY3Rpb24odmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0c0xvZ2dlci5zZXRVc2VySW5mbyh2YWx1ZSk7ICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmKHRzTG9nZ2VyLnRzUGVyZm9ybWFuY2UpIHt3aW5kb3cucGFyZW50Lk9SQUNMRV9TRVJWSUNFX0NMT1VELkNvbmZpZ3VyYXRpb24uaXNQZXJmb3JtYW5jZU1vbml0b3JpbmdFbmFibGVkPXRydWU7fVxyXG4gICAgICAgICAgICBpZih0c0xvZ2dlci50c0RlYnVnTGV2ZWwgPiAwKSB7d2luZG93LnBhcmVudC5PUkFDTEVfU0VSVklDRV9DTE9VRC5Db25maWd1cmF0aW9uLmxvZ0xldmVsID0gNTt9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBuYXZpZ2F0b3Iuc2F5c3dobz0gKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgdWE9IG5hdmlnYXRvci51c2VyQWdlbnQsIHRlbSwgXHJcbiAgICAgICAgICAgICAgICBNPSB1YS5tYXRjaCgvKG9wZXJhfGNocm9tZXxzYWZhcml8ZmlyZWZveHxtc2llfHRyaWRlbnQoPz1cXC8pKVxcLz9cXHMqKFxcZCspL2kpIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYoL3RyaWRlbnQvaS50ZXN0KE1bMV0pKXtcclxuICAgICAgICAgICAgICAgICAgICB0ZW09ICAvXFxicnZbIDpdKyhcXGQrKS9nLmV4ZWModWEpIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnSUUgJysodGVtWzFdIHx8ICcnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKE1bMV09PT0gJ0Nocm9tZScpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbT0gdWEubWF0Y2goL1xcYihPUFJ8RWRnZSlcXC8oXFxkKykvKTtcclxuICAgICAgICAgICAgICAgICAgICBpZih0ZW0hPSBudWxsKSByZXR1cm4gdGVtLnNsaWNlKDEpLmpvaW4oJyAnKS5yZXBsYWNlKCdPUFInLCAnT3BlcmEnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIE09IE1bMl0/IFtNWzFdLCBNWzJdXTogW25hdmlnYXRvci5hcHBOYW1lLCBuYXZpZ2F0b3IuYXBwVmVyc2lvbiwgJy0/J107XHJcbiAgICAgICAgICAgICAgICBpZigodGVtPSB1YS5tYXRjaCgvdmVyc2lvblxcLyhcXGQrKS9pKSkhPSBudWxsKSBNLnNwbGljZSgxLCAxLCB0ZW1bMV0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE0uam9pbignICcpO1xyXG4gICAgICAgICAgICB9KSgpO1xyXG5cclxuICAgICAgICAgICAgdHNMb2dnZXIudHNOYXZpZ2F0b3JJbmZvID0gbmF2aWdhdG9yLnNheXN3aG87XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvL2xvZ1xyXG4gICAgICAgICAgICBjb25zb2xlLmRlZmF1bHRMb2cgPSBjb25zb2xlLmxvZy5iaW5kKHdpbmRvdy5wYXJlbnQuY29uc29sZSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9ncyA9IFtdO1xyXG4gICAgICAgICAgICB3aW5kb3cucGFyZW50LmNvbnNvbGUubG9nID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIC8vIGRlZmF1bHQgJiAgY29uc29sZS5sb2coKVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5kZWZhdWx0TG9nKGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgICAgICAvLyBuZXcgJiBhcnJheSBkYXRhXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9ncy5wdXNoKEFycmF5LmZyb20oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBBcnJheS5mcm9tKGFyZ3VtZW50cykuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UgKyAnXFxuJysgdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIHRzTG9nZ2VyLnRzQ29uc29sZUxvZy5wdXNoKHsnaWQnOiB0c0xvZ2dlci50c0NvbnNvbGVMb2cubGVuZ3RoICsgMSAsICdsb2cnOiBtZXNzYWdlfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9lcnJvclxyXG4gICAgICAgICAgICBjb25zb2xlLmRlZmF1bHRFcnJvciA9IGNvbnNvbGUuZXJyb3IuYmluZCh3aW5kb3cucGFyZW50LmNvbnNvbGUpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9ycyA9IFtdO1xyXG4gICAgICAgICAgICB3aW5kb3cucGFyZW50LmNvbnNvbGUuZXJyb3IgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgLy8gZGVmYXVsdCAmICBjb25zb2xlLmVycm9yKClcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVmYXVsdEVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgICAgICAvLyBuZXcgJiBhcnJheSBkYXRhXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUuZXJyb3JzLnB1c2goQXJyYXkuZnJvbShhcmd1bWVudHMpKTtcclxuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIEFycmF5LmZyb20oYXJndW1lbnRzKS5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlKXtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gbWVzc2FnZSArICdcXG4nKyB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgdHNMb2dnZXIudHNDb25zb2xlRXJyb3IucHVzaCh7J2lkJzogdHNMb2dnZXIudHNDb25zb2xlRXJyb3IubGVuZ3RoICsgMSAsICdsb2cnOiBtZXNzYWdlfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vd2FyblxyXG4gICAgICAgICAgICBjb25zb2xlLmRlZmF1bHRXYXJuID0gY29uc29sZS53YXJuLmJpbmQod2luZG93LnBhcmVudC5jb25zb2xlKTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZS53YXJucyA9IFtdOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB3aW5kb3cucGFyZW50LmNvbnNvbGUud2FybiA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0ICYgIGNvbnNvbGUud2FybigpXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmRlZmF1bHRXYXJuLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgICAgICAvLyBuZXcgJiBhcnJheSBkYXRhXHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUud2FybnMucHVzaChBcnJheS5mcm9tKGFyZ3VtZW50cykpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgQXJyYXkuZnJvbShhcmd1bWVudHMpLmZvckVhY2goZnVuY3Rpb24odmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlICsgJ1xcbicrIHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICB0c0xvZ2dlci50c0NvbnNvbGVXYXJuLnB1c2goeydpZCc6IHRzTG9nZ2VyLnRzQ29uc29sZVdhcm4ubGVuZ3RoICsgMSAsICdsb2cnOiBtZXNzYWdlfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vZGVidWdcclxuICAgICAgICAgICAgY29uc29sZS5kZWZhdWx0RGVidWcgPSBjb25zb2xlLmRlYnVnLmJpbmQod2luZG93LnBhcmVudC5jb25zb2xlKTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZS5kZWJ1Z3MgPSBbXTtcclxuICAgICAgICAgICAgd2luZG93LnBhcmVudC5jb25zb2xlLmRlYnVnID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIC8vIGRlZmF1bHQgJiAgY29uc29sZS5kZWJ1ZygpXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmRlZmF1bHREZWJ1Zy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICAgICAgLy8gbmV3ICYgYXJyYXkgZGF0YVxyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmRlYnVncy5wdXNoKEFycmF5LmZyb20oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBBcnJheS5mcm9tKGFyZ3VtZW50cykuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UgKyAnXFxuJysgdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIHRzTG9nZ2VyLnRzQ29uc29sZURlYnVnLnB1c2goeydpZCc6IHRzTG9nZ2VyLnRzQ29uc29sZURlYnVnLmxlbmd0aCArIDEgLCAnbG9nJzogbWVzc2FnZX0pO1xyXG4gICAgICAgICAgICB9IFxyXG5cclxuICAgICAgICB9ICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHN0b3BDYXB0dXJlKGlzUnVubmluZzogYm9vbGVhbiwgdHNUaWNrZXI6IFRzVGlja2VyLCB0c0xvZ2dlcjogVHNMb2dnZXIpe1xyXG5cclxuICAgICAgICBpZihpc1J1bm5pbmcgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpc1J1bm5pbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQuT1JBQ0xFX1NFUlZJQ0VfQ0xPVUQuQ29uZmlndXJhdGlvbi5sb2dMZXZlbCA9IDA7XHJcbiAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQuT1JBQ0xFX1NFUlZJQ0VfQ0xPVUQuQ29uZmlndXJhdGlvbi5pc1BlcmZvcm1hbmNlTW9uaXRvcmluZ0VuYWJsZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIC8vU3RvcCBzdG9wX3dhdGNoZXJcclxuICAgICAgICAgICAgdHNUaWNrZXIuc3RvcFRpbWVyKHRzTG9nZ2VyKTtcclxuXHJcbiAgICAgICAgICAgIC8vQ3JlYXRlIEhUTUwgdG8gc2hvdyBjYXB0dXJlIHJlc3VsdHMuXHJcbiAgICAgICAgICAgIGNvbnN0IHRzUmVzdWx0cyA9IG5ldyBUc1Jlc3VsdHModHNMb2dnZXIpOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0c1Jlc3VsdHMuc2F2ZUxvY2FsQmxvYigpO1xyXG5cclxuICAgICAgICAgICAgLy9TaG93IE1vZGFsIHdpdGggY2FwdHVyZSByZXN1bHRzLlxyXG4gICAgICAgICAgICBUc1V0aWxpdGllcy5NeU1vZGFsV2luZG93KCk7XHJcblxyXG4gICAgICAgICAgICB0c0xvZ2dlci50c0NvbnNvbGVEZWJ1ZyA9IFtdO1xyXG4gICAgICAgICAgICB0c0xvZ2dlci50c0NvbnNvbGVXYXJuID0gW107XHJcbiAgICAgICAgICAgIHRzTG9nZ2VyLnRzQ29uc29sZUVycm9yID0gW107XHJcbiAgICAgICAgICAgIHRzTG9nZ2VyLnRzQ29uc29sZUxvZyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuXHJcbm5ldyBUc0V4dGVuc2lvbigpO1xyXG4iXX0=